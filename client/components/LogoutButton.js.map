{"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;ACAA;;;;;;;;ACCA;;;;;;;ACDA;;;;;;;ACAA;AAEA,MAAM,0BAAI,GAAG,IAAM,EAAE;AAEN,oDAAyB;IACtC,IAAI,QAAQ,GAAG,CAAA,GAAA,eAAQ,CAAA,EAAE,CAAC,CAAC,CAAC;IAC5B,CAAA,GAAA,gBAAS,CAAA,CAAC,IAAM,IAAM;YAAE,QAAQ,GAAG,0BAAI;SAAE,EAAE,EAAE,CAAC;IAC9C,OAAO,CAAA,GAAA,kBAAW,CAAA,CAAC,IAAM;QAAE,QAAQ,CAAC,EAAE,CAAC;KAAE,EAAE,EAAE,CAAC,CAAA;CAC/C;;;ADJD,MAAM,4BAAM,GAAG;IAAC,MAAM;IAAE,SAAS;IAAE,UAAU;IAAE,UAAU;CAAC;AAC3C,kDAAkB,aAAa,EAAE,MAAM,GAAG,EAAE,EAAC;IAC1D,MAAM,eAAE,WAAW,CAAA,aAAE,SAAS,CAAA,aAAE,SAAS,CAAA,cAAE,UAAU,CAAA,EAAE,GAAG,MAAM;IAChE,MAAM,WAAW,GAAG,CAAA,GAAA,wCAAc,CAAA,EAAE;IACpC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAA,GAAA,eAAQ,CAAA,CAAC,EAAE,CAAC;IAE1B,MAAM,QAAQ,GAAG,CAAA,KAAK,GAAI;QACxB,GAAG,CAAC,KAAK,GAAG,4BAAM,CAAC,KAAK,CAAC;QACzB,4BAAM,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,KAAK,GAAK;YAC9B,GAAG,CAAC,IAAI,CAAC,GAAG,KAAK,KAAK,KAAK;SAC5B,CAAC;QACF,WAAW,EAAE;KACd;IAED,IAAI,GAAG,CAAC,KAAK,KAAK,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC;IAExC,GAAG,CAAC,IAAI,GAAG,CAAA,GAAA,kBAAW,CAAA,CACpB,CAAI,GAAA,IAAI,GAAK;QACX,IAAI,GAAG,CAAC,OAAO,EAAE,MAAM,IAAI,KAAK,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAA;QACrD,GAAG,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,GAAK;YAC7C,aAAa,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC;SAC7C,CAAC,CAAC,IAAI,CACL,OAAM,MAAM,GAAI;YACd,OAAO,GAAG,CAAC,OAAO;YAClB,GAAG,CAAC,MAAM,GAAG,MAAM;YACnB,QAAQ,CAAC,CAAC,CAAC;YACX,IAAI,SAAS,EAAE,MAAM,SAAS,CAAC,MAAM,CAAC;YACtC,OAAO,MAAM,CAAA;SACd,EACD,OAAM,KAAK,GAAI;YACb,OAAO,GAAG,CAAC,OAAO;YAClB,GAAG,CAAC,KAAK,GAAG,KAAK;YACjB,IAAI,SAAS,EAAE,MAAM,SAAS,CAAC,KAAK,CAAC;YACrC,QAAQ,CAAC,CAAC,CAAC;YACX,OAAO,KAAK,CAAA;SACb,CACF,CAAC,IAAI,CAAC,CAAA,MAAM,GAAI;YACf,IAAI,UAAU,EAAE,UAAU,CAAC,MAAM,CAAC;SACnC,CAAC;QACF,QAAQ,CAAC,CAAC,CAAC;QACX,OAAO,GAAG,CAAC,OAAO,CAAA;KACnB,EACD;QAAC,aAAa;KAAC,CAChB;IAED,CAAA,GAAA,gBAAS,CAAA,CACP,IAAM;QAAE,IAAI,WAAW,IAAI,GAAG,CAAC,KAAK,KAAK,4BAAM,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,IAAI,EAAE;KAAE,EAClE;QAAC,GAAG,CAAC,IAAI;QAAE,WAAW;QAAE,GAAG,CAAC,KAAK;KAAC,CACnC;IAED,OAAO,GAAG,CAAA;CACX;;;AEvDD,MAAM,0BAAI,GAAG,CAAA,EAAE,GAAI,IAAI,OAAO,CAAC,CAAA,OAAO,GAAI;QACxC,UAAU,CAAC,IAAM;YAAE,OAAO,EAAE;SAAE,EAAE,EAAE,CAAC;KACpC,CAAC;IACF,wCAAmB,GAAJ,0BAAI;;;AHGZ,eAAe,yCAAU,CAAC,IAAI,EAAE,OAAO,GAAG,EAAE,EAAC;IAClD,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;IACpC,MAAM,MAAM,GAAG,IAAI,KAAK,IAAI,GAAG,EAAE,GAC/B,GAAG,GAAG,IAAI,eAAe,CAAC;QAAE,CAAC,EAAE,IAAI;KAAE,CAAC;IACxC,OAAO,MAAM,8BAAQ,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAA;CACtD;AAEM,eAAe,yCAAY,CAAC,IAAI,EAAE,OAAO,EAAC;IAC/C,OAAO,MAAM,8BAAQ,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,CAAA;CACvD;AACD,IAAI,CACJ,cAAM,CAAC,KAAK,GAAG;IACb,KAAK,EAAE,yCAAU;IACjB,OAAO,EAAE,yCAAY;CACtB;AAED,eAAe,8BAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,GAAG,CAAC,EAAC;IACpD,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,IAAI,EAAE;gBAC5B,MAAM;QACN,OAAO,EAAE;YACP,SAAS,EAAE,kBAAkB;YAC7B,cAAc,EAAE,kBAAkB;SACnC;QACD,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,SAAS;KAC9C,CAAC;IACF,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EACpB,MAAM,IAAI,KAAK,CAAC,CAAC,uCAAuC,CAAC,CAAC,CAAA;IAE5D,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,IAAI,KAAK,GAAG,CAAC,EAAE;QACnC,MAAM,CAAA,GAAA,wCAAI,CAAA,CAAC,GAAG,CAAC;QACf,OAAO,8BAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,GAAG,CAAC,CAAC,CAAA;KAC/C;IACD,MAAM,UAAE,MAAM,CAAA,SAAE,KAAK,CAAA,EAAE,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE;IAC1C,IAAI,KAAK,EAAE,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;IACzC,OAAO,MAAM,IAAI,IAAI,CAAA;CACtB;AAEM,SAAS,yCAAQ,CAAC,IAAI,EAAE,OAAO,GAAG,EAAE,EAAE,MAAM,EAAC;IAClD,MAAM,MAAM,GAAG,IAAI,GAAG;QAAC,IAAI;QAAE,OAAO;KAAC,GAAG,IAAI;IAC5C,MAAM,EAAE,IAAI,EAAE,MAAM,CAAA,SAAE,KAAK,CAAA,UAAE,MAAM,CAAA,EAAE,GAAG,CAAA,GAAA,UAAM,CAAA,CAAC,MAAM,EAAE;QACrD,GAAG,MAAM;QACT,OAAO,EAAE,yCAAU;KACpB,CAAC;IACF,MAAM,OAAO,GAAG,OAAO,MAAM,KAAK,WAAW,IAAI,CAAC,KAAK;IACvD,MAAM,MAAM,GAAG,CAAA,GAAA,kBAAW,CAAA,CAAC,IAAM;QAAE,MAAM,EAAE;KAAE,EAAE;QAAC,MAAM;KAAC,CAAC;IACxD,OAAO;gBAAE,MAAM;iBAAE,OAAO;eAAE,KAAK;gBAAE,MAAM;gBAAE,MAAM;KAAE,CAAA;CAClD;AAEM,SAAS,yCAAU,CAAC,IAAI,EAAE,MAAM,EAAC;IACtC,OAAO,CAAA,GAAA,wCAAQ,CAAA,CACb,CAAA,OAAO,GAAI,yCAAY,CAAC,IAAI,EAAE,OAAO,CAAC,EACtC,MAAM,CACP,CAAA;CACF;AAEM,SAAS,yCAAiB,CAAC,IAAI,EAAE,OAAO,EAAE,MAAM,EAAC;IACtD,MAAM,OAAO,GAAG,yCAAU,CAAC,IAAI,EAAE,MAAM,CAAC;IACxC,CAAA,GAAA,gBAAS,CAAA,CACP,IAAM;QAAE,IAAI,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC;KAAE,EACjD;QAAC,IAAI;QAAE,OAAO;KAAC,CAChB;IACD,OAAO,OAAO,CAAA;CACf;;;ADjEM,SAAS,yCAAc,GAAE;IAC9B,MAAM,EAAE,MAAM,EAAE,WAAW,CAAA,WAAE,OAAO,CAAA,SAAE,KAAK,CAAA,UAAE,MAAM,CAAA,EAAE,GAAG,CAAA,GAAA,yCAAQ,CAAA,CAAC,qBAAqB,CAAC;IACvF,MAAM,MAAM,GAAG,CAAA,GAAA,kBAAW,CAAA,CAAC,IAAM;QAAE,MAAM,EAAE;KAAE,EAAE;QAAC,MAAM;KAAC,CAAC;IACxD,OAAO;qBAAE,WAAW;iBAAE,OAAO;eAAE,KAAK;gBAAE,MAAM;gBAAE,MAAM;KAAE,CAAA;CACvD;AAEM,SAAS,yCAAW,GAAE;IAC3B,OAAO,EAAE,CAAA;CACV;AAEM,SAAS,yCAAqB,GAAE;AACrC,iCAAiC;AACjC,aAAa;AACb,YAAY;AACZ,0BAA0B;AAC1B,6CAA6C;AAC7C,oCAAoC;AACpC,uDAAuD;AACvD,uCAAuC;AACvC,QAAQ;AACR,OAAO;AACP,MAAM;AACN,gBAAgB;AAChB,eAAe;AACf,mBAAmB;AACnB,yBAAyB;AACzB,2BAA2B;AAC3B,MAAM;AACN,IAAI;CACL;AAEM,SAAS,yCAAwB,GAAE,EAEzC;AAED,SAAS,oDAA8B,CAAC,MAAM,EAAE,SAAS,GAAG,EAAE,EAAC;IAC7D,MAAM,UAAE,MAAM,CAAA,EAAE,GAAG,yCAAc,EAAE;IACnC,OAAO,CAAA,GAAA,yCAAU,CAAA,CAAC,MAAM,EAAE;QACxB,GAAG,SAAS;QACZ,SAAS,EAAC,WAAW,EAAC;YACpB,MAAM,CAAC,WAAW,CAAC;YACnB,IAAI,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC;SAC1D;KACF,CAAC,CAAA;CACH;AAEM,MAAM,yCAAQ,GAAG,CAAA,SAAS,GAC/B,oDAA8B,CAAC,YAAY,EAAE,SAAS,CAAC;AAElD,MAAM,yCAAS,GAAG,CAAA,SAAS,GAChC,oDAA8B,CAAC,aAAa,EAAE,SAAS,CAAC;AAEnD,MAAM,yCAAS,GAAG,CAAA,SAAS,GAChC,oDAA8B,CAAC,aAAa,EAAE,SAAS,CAAC;;;ADpD3C,kDAAsB,YAAE,QAAQ,CAAA,EAAE,GAAG,KAAK,EAAE,EAAC;IAC1D,MAAM,MAAM,GAAG,CAAA,GAAA,yCAAS,CAAA,EAAE;IAC1B,MAAM,OAAO,GAAG,kBAAiB,CAAC,IAAM;QAAE,MAAM,CAAC,IAAI,EAAE;KAAE,EAAE;QAAC,MAAM,CAAC,IAAI;KAAC,CAAC;IACzE,qBAAO,gBAAC,CAAA,GAAA,wBAAM,CAAA;QAAM,GAAG,KAAK;iBAAE,OAAO;kBAAK,QAAQ,IAAI,QAAQ;MAAU,CAAA;CACzE","sources":["client-src/components/LogoutButton.js","client-src/hooks/auth.js","client-src/hooks/cqrpc.js","client-src/hooks/useAsync.js","client-src/hooks/useForceUpdate.js","wait.js"],"sourcesContent":["import * as React from 'react'\nimport Button from '@mui/material/Button'\nimport { useLogout } from '../hooks/auth'\n\nexport default function LogoutButton({ children, ...props }){\n  const logout = useLogout()\n  const onClick = React.useCallback(() => { logout.call() }, [logout.call])\n  return <Button {...{...props, onClick }}>{children || 'logout'}</Button>\n}\n","import { useCallback, useEffect } from 'react'\nimport { useQuery, useCommand } from './cqrpc'\n\nexport function useCurrentUser(){\n  const { result: currentUser, loading, error, mutate } = useQuery('auth.getCurrentUser')\n  const reload = useCallback(() => { mutate() }, [mutate])\n  return { currentUser, loading, error, mutate, reload }\n}\n\nexport function useLoggedIn(){\n  return {}\n}\n\nexport function useRedirectIfLoggedIn(){\n  // const navigate = useNavigate()\n  // useEffect(\n  //   () => {\n  //     if (loading) return\n  //     if (redirectToIfFound && currentUser){\n  //       navigate(redirectToIfFound)\n  //     }else if (redirectToIfNotFound && !currentUser){\n  //       navigate(redirectToIfNotFound)\n  //     }\n  //   },\n  //   [\n  //     navigate,\n  //     loading,\n  //     currentUser,\n  //     redirectToIfFound,\n  //     redirectToIfNotFound\n  //   ]\n  // )\n}\n\nexport function useRedirectIfNotLoggedIn(){\n\n}\n\nfunction useCommandAndReloadCurrentUser(action, callbacks = {}){\n  const { mutate } = useCurrentUser()\n  return useCommand(action, {\n    ...callbacks,\n    onSuccess(currentUser){\n      mutate(currentUser)\n      if (callbacks.onSuccess) callbacks.onSuccess(currentUser)\n    },\n  })\n}\n\nexport const useLogin = callbacks =>\n  useCommandAndReloadCurrentUser('auth.login', callbacks)\n\nexport const useLogout = callbacks =>\n  useCommandAndReloadCurrentUser('auth.logout', callbacks)\n\nexport const useSignup = callbacks =>\n  useCommandAndReloadCurrentUser('auth.signup', callbacks)\n\n","// Command. Query. Remote. Procedure. Call\nimport { useEffect, useCallback } from 'react'\nimport useSWR from 'swr'\nimport useAsync from './useAsync'\nimport wait from '../../wait.js'\n\nexport async function fetchQuery(name, options = {}){\n  const json = JSON.stringify(options)\n  const params = json === '{}' ? '' :\n    '?' + new URLSearchParams({ o: json })\n  return await apiFetch('GET', `/api/${name}${params}`)\n}\n\nexport async function fetchCommand(name, options){\n  return await apiFetch('POST', `/api/${name}`, options)\n}\n/**/\nglobal.cqrpc = {\n  query: fetchQuery,\n  command: fetchCommand,\n}\n\nasync function apiFetch(method, path, body, tries = 0){\n  const res = await fetch(path, {\n    method,\n    headers: {\n      'Accepts': 'application/json',\n      'Content-Type': 'application/json',\n    },\n    body: body ? JSON.stringify(body) : undefined,\n  })\n  if (res.status === 502){\n    throw new Error(`API server looks down or you're offline`)\n  }\n  if (res.status === 504 && tries < 5) {\n    await wait(500)\n    return apiFetch(method, path, body, tries + 1)\n  }\n  const { result, error } = await res.json()\n  if (error) throw new Error(error.message)\n  return result || null\n}\n\nexport function useQuery(name, options = {}, config){\n  const swrKey = name ? [name, options] : null\n  const { data: result, error, mutate } = useSWR(swrKey, {\n    ...config,\n    fetcher: fetchQuery,\n  })\n  const loading = typeof result === 'undefined' && !error\n  const reload = useCallback(() => { mutate() }, [mutate])\n  return { result, loading, error, mutate, reload }\n}\n\nexport function useCommand(name, config){\n  return useAsync(\n    options => fetchCommand(name, options),\n    config\n  )\n}\n\nexport function useCommandOnMount(name, options, config){\n  const command = useCommand(name, config)\n  useEffect(\n    () => { if (command.idle) command.call(options) },\n    [name, options]\n  )\n  return command\n}\n","import * as React from 'react'\nimport { useState, useCallback, useEffect } from 'react'\nimport useForceUpdate from './useForceUpdate'\n\nconst STATES = ['idle', 'pending', 'resolved', 'rejected']\nexport default function useAsync(asyncFunction, config = {}){\n  const { callOnMount, onSuccess, onFailure, onComplete } = config\n  const forceUpdate = useForceUpdate()\n  const [ctx] = useState({})\n\n  const setState = state => {\n    ctx.state = STATES[state]\n    STATES.forEach((name, index) => {\n      ctx[name] = index === state\n    })\n    forceUpdate()\n  }\n\n  if (ctx.state === undefined) setState(0)\n\n  ctx.call = useCallback(\n    (...args) => {\n      if (ctx.promise) throw new Error(`already executing`)\n      ctx.promise = new Promise((resolve, reject) => {\n        asyncFunction(...args).then(resolve, reject)\n      }).then(\n        async result => {\n          delete ctx.promise\n          ctx.result = result\n          setState(2)\n          if (onSuccess) await onSuccess(result)\n          return result\n        },\n        async error => {\n          delete ctx.promise\n          ctx.error = error\n          if (onFailure) await onFailure(error)\n          setState(3)\n          return error\n        },\n      ).then(result => {\n        if (onComplete) onComplete(result)\n      })\n      setState(1)\n      return ctx.promise\n    },\n    [asyncFunction]\n  )\n\n  useEffect(\n    () => { if (callOnMount && ctx.state === STATES['0']) ctx.call() },\n    [ctx.call, callOnMount, ctx.state]\n  )\n\n  return ctx\n}\n","import { useState, useCallback, useEffect } from 'react'\n\nconst noop = () => {}\n\nexport default function useForceUpdate(){\n  let setState = useState()[1]\n  useEffect(() => () => { setState = noop }, [])\n  return useCallback(() => { setState({}) }, [])\n}\n","const wait = ms => new Promise(resolve => {\n  setTimeout(() => { resolve() }, ms)\n})\nexport default wait\n"],"names":[],"version":3,"file":"LogoutButton.js.map","sourceRoot":"../../"}