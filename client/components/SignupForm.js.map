{"mappings":"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","sources":["client-src/components/SignupForm.js","client-src/components/Link.js","client-src/components/ErrorMessage.js","client-src/hooks/auth.js","client-src/hooks/cqrpc.js","client-src/hooks/useAsync.js","client-src/hooks/useForceUpdate.js","shared/wait.js"],"sourcesContent":["import { useState } from 'react'\n\nimport Paper from '@mui/material/Paper'\nimport Typography from '@mui/material/Typography'\nimport Stack from '@mui/material/Stack'\nimport Button from '@mui/material/Button'\nimport Box from '@mui/material/Box'\nimport TextField from '@mui/material/TextField'\n\nimport Link from './Link'\nimport ErrorMessage from './ErrorMessage'\nimport { useSignup } from '../hooks/auth'\n\nexport default function SignupForm({\n  onSuccess,\n  onFailure,\n  ...props\n}){\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n\n  const signup = useSignup({\n    onSuccess,\n    onFailure,\n  })\n\n  const onSubmit = event => {\n    event.preventDefault()\n    signup.call({\n      email: email || undefined,\n      password: password || undefined,\n    })\n  }\n\n  const disabled = !!signup.pending\n  // const emailIsValid = email.length >= 3 && email.includes('@')\n  // const secretKeyIsValid = PassphraseInput.isValid(secretKey)\n  const submittable = !!(email ?? password)\n  return <Paper {...{\n    ...props,\n    sx: {\n      ...props.sx,\n      minWidth: `min(100vw, 500px)`,\n    }\n  }}>\n    <Typography variant=\"h4\" mb={2}>Signup</Typography>\n    <Box {...{\n      component: 'form',\n      onSubmit,\n    }}>\n      <ErrorMessage error={signup.error}/>\n      <TextField\n        label=\"email\"\n        autoComplete=\"email\"\n        disabled={disabled}\n        margin=\"normal\"\n        fullWidth\n        name=\"email\"\n        type=\"email\"\n        value={email}\n        onChange={e => { setEmail(e.target.value) }}\n      />\n      <TextField\n        label=\"password\"\n        autoComplete=\"email\"\n        disabled={disabled}\n        margin=\"normal\"\n        fullWidth\n        name=\"password\"\n        type=\"password\"\n        value={password}\n        onChange={e => { setPassword(e.target.value) }}\n      />\n      <Stack spacing={2} direction=\"row-reverse\" alignItems=\"center\" mt={2}>\n        <Button\n          disabled={disabled || !submittable}\n          type=\"submit\"\n          variant=\"contained\"\n          size=\"large\"\n        >Signup</Button>\n        <Link variant=\"text\" to=\"/signup\">back</Link>\n      </Stack>\n    </Box>\n\n  </Paper>\n}\n","import * as React from 'react'\nimport { Link as RouterLink } from 'react-router-dom'\nimport MUILink from '@mui/material/Link'\n\nconst Link = React.forwardRef(({...props}, ref) => {\n  props.component = 'a'\n  if (props.to){\n    props.component = RouterLink\n  }\n  if (props.to && props.to.startsWith('http')){\n    props.href = props.to\n    delete props.to\n    props.rel = props.rel || \"noopener noreferrer\"\n    props.target = props.target || \"_blank\"\n    props.component = 'a'\n  }\n  return <MUILink {...props} ref={ref}/>\n})\n\nLink.displayName = 'Link'\n\nexport default Link\n","import * as React from 'react'\nimport Alert from '@mui/material/Alert'\n\nconst ErrorMessage = ({error, ...props}) => {\n  if (!error) return null\n  return <Alert severity=\"error\" {...props}>{error.message}</Alert>\n}\n\nexport default ErrorMessage\n","import { useCallback, useEffect } from 'react'\nimport { useQuery, useCommand } from './cqrpc'\n\nexport function useCurrentUser(){\n  const { result: currentUser, loading, error, mutate } = useQuery('auth.getCurrentUser')\n  const reload = useCallback(() => { mutate() }, [mutate])\n  return { currentUser, loading, error, mutate, reload }\n}\n\nexport function useLoggedIn(){\n  return {}\n}\n\nexport function useRedirectIfLoggedIn(){\n  // const navigate = useNavigate()\n  // useEffect(\n  //   () => {\n  //     if (loading) return\n  //     if (redirectToIfFound && currentUser){\n  //       navigate(redirectToIfFound)\n  //     }else if (redirectToIfNotFound && !currentUser){\n  //       navigate(redirectToIfNotFound)\n  //     }\n  //   },\n  //   [\n  //     navigate,\n  //     loading,\n  //     currentUser,\n  //     redirectToIfFound,\n  //     redirectToIfNotFound\n  //   ]\n  // )\n}\n\nexport function useRedirectIfNotLoggedIn(){\n\n}\n\nexport function useCommandAndReloadCurrentUser(action, callbacks = {}){\n  const { mutate } = useCurrentUser()\n  return useCommand(action, {\n    ...callbacks,\n    onSuccess(currentUser){\n      mutate(currentUser)\n      if (callbacks.onSuccess) callbacks.onSuccess(currentUser)\n    },\n  })\n}\n\nexport const useLogin = callbacks =>\n  useCommandAndReloadCurrentUser('auth.login', callbacks)\n\nexport const useLogout = callbacks =>\n  useCommandAndReloadCurrentUser('auth.logout', callbacks)\n\nexport const useSignup = callbacks =>\n  useCommandAndReloadCurrentUser('auth.signup', callbacks)\n\n","// Command. Query. Remote. Procedure. Call\nimport { useEffect, useCallback } from 'react'\nimport useSWR from 'swr'\nimport useAsync from './useAsync'\nimport wait from '../../shared/wait.js'\n\nexport async function fetchQuery(name, options = {}){\n  const json = JSON.stringify(options)\n  const params = json === '{}' ? '' :\n    '?' + new URLSearchParams({ o: json })\n  return await apiFetch('GET', `/api/${name}${params}`)\n}\n\nexport async function fetchCommand(name, options){\n  return await apiFetch('POST', `/api/${name}`, options)\n}\n/**/\nglobal.cqrpc = {\n  query: fetchQuery,\n  command: fetchCommand,\n}\n\nasync function apiFetch(method, path, body, tries = 0){\n  const res = await fetch(path, {\n    method,\n    headers: {\n      'Accepts': 'application/json',\n      'Content-Type': 'application/json',\n    },\n    body: body ? JSON.stringify(body) : undefined,\n  })\n  if (res.status === 502){\n    throw new Error(`API server looks down or you're offline`)\n  }\n  if (res.status === 504 && tries < 5) {\n    await wait(500)\n    return apiFetch(method, path, body, tries + 1)\n  }\n  const { result, error } = await res.json()\n  if (error) throw new Error(error.message)\n  return result || null\n}\n\nexport function useQuery(name, options = {}, config){\n  const swrKey = name ? [name, options] : null\n  const { data: result, error, mutate } = useSWR(swrKey, {\n    ...config,\n    fetcher: fetchQuery,\n  })\n  const loading = typeof result === 'undefined' && !error\n  const reload = useCallback(() => { mutate() }, [mutate])\n  return { result, loading, error, mutate, reload }\n}\n\nexport function useCommand(name, config){\n  return useAsync(\n    options => fetchCommand(name, options),\n    config\n  )\n}\n\nexport function useCommandOnMount(name, options, config){\n  const command = useCommand(name, config)\n  useEffect(\n    () => { if (command.idle) command.call(options) },\n    [name, options]\n  )\n  return command\n}\n","import * as React from 'react'\nimport { useRef, useMemo, useCallback, useEffect } from 'react'\nimport useForceUpdate from './useForceUpdate'\n\nconst STATES = ['idle', 'pending', 'resolved', 'rejected']\nexport default function useAsync(asyncFunction, config = {}){\n  const { callOnMount, onSuccess, onFailure, onComplete } = config\n  const callbacks = useRef()\n  Object.assign(callbacks, { onSuccess, onFailure, onComplete })\n  const forceUpdate = useForceUpdate()\n  const ctx = useMemo(() => ({}), [asyncFunction, callOnMount])\n\n  ctx.call = useCallback(\n    (...args) => {\n      if (ctx.promise) throw new Error(`already executing`)\n      const setState = state => {\n        ctx.state = STATES[state]\n        STATES.forEach((name, index) => {\n          ctx[name] = index === state\n        })\n        forceUpdate()\n      }\n      ctx.promise = new Promise((resolve, reject) => {\n        asyncFunction(...args).then(resolve, reject)\n      }).then(\n        async result => {\n          delete ctx.promise\n          ctx.result = result\n          setState(2)\n          if (callbacks.onSuccess) await callbacks.onSuccess(result)\n          return result\n        },\n        async error => {\n          delete ctx.promise\n          ctx.error = error\n          if (callbacks.onFailure) await callbacks.onFailure(error)\n          setState(3)\n          return error\n        },\n      ).then(async result => {\n        if (callbacks.onComplete) await callbacks.onComplete(result)\n      })\n      setState(1)\n      return ctx.promise\n    },\n    [ctx]\n  )\n\n  useEffect(\n    () => { if (callOnMount && ctx.idle) ctx.call() },\n    [ctx]\n  )\n\n  return ctx\n}\n","import { useState, useCallback, useEffect } from 'react'\n\nconst noop = () => {}\n\nexport default function useForceUpdate(){\n  let setState = useState()[1]\n  useEffect(() => () => { setState = noop }, [])\n  return useCallback(() => { setState({}) }, [])\n}\n","const wait = ms => new Promise(resolve => {\n  setTimeout(() => { resolve() }, ms)\n})\nexport default wait\n"],"names":[],"version":3,"file":"SignupForm.js.map","sourceRoot":"../../"}