{"mappings":"shCAIA,MAAMA,EAAOC,EAAAC,YAAiB,KAAKC,GAAQC,KACzCD,EAAME,UAAY,IACdF,EAAMG,KACRH,EAAME,UAAYE,EAAAC,MAEhBL,EAAMG,IAAMH,EAAMG,GAAGG,WAAW,UAClCN,EAAMO,KAAOP,EAAMG,UACZH,EAAMG,GACbH,EAAMQ,IAAMR,EAAMQ,KAAO,sBACzBR,EAAMS,OAAST,EAAMS,QAAU,SAC/BT,EAAME,UAAY,MAEb,EAAAQ,EAAAC,KAACC,EAAAC,GAAO,IAAKb,EAAOC,IAAKA,OAGlCJ,EAAKiB,YAAc,OCfZC,eAAeC,EAAWC,EAAMC,EAAU,IAC/C,MAAMC,EAAS,IAAIC,gBAAgBF,GACnC,aAAaG,EAAS,MAAO,QAAQJ,KAAQE,I,CAGxCJ,eAAeO,EAAaL,EAAMC,GACvC,aAAaG,EAAS,OAAQ,QAAQJ,IAAQC,E,CAQhDH,eAAeM,EAASE,EAAQC,EAAMC,EAAMC,EAAQ,GAClD,MAAMC,QAAYC,MAAMJ,EAAM,C,OAC5BD,EACAM,QAAS,CACPC,QAAW,mBACX,eAAgB,oBAElBL,KAAMA,EAAOM,KAAKC,UAAUP,QAAQQ,IAEtC,GAAmB,MAAfN,EAAIO,OACN,MAAM,IAAIC,MAAM,2CAElB,GAAmB,MAAfR,EAAIO,QAAkBR,EAAQ,EAEhC,aADMU,EAAK,KACJf,EAASE,EAAQC,EAAMC,EAAMC,EAAQ,GAE9C,MAAMW,OAAEA,EAAMC,MAAEA,SAAgBX,EAAIY,OACpC,GAAID,EAAO,MAAM,IAAIH,MAAMG,EAAME,SACjC,OAAOH,GAAU,I,CAvBnBI,OAAOC,KAAO,CACZC,MAAO3B,EACP4B,QAAStB,GAwBX,MAAMc,EAAOS,GAAM,IAAIC,SAAQC,IAC7BC,YAAW,KAAQD,GAAS,GAAIF,EAAG","sources":["client/components/Link.js","client/cqrs.js"],"sourcesContent":["import * as React from 'react'\nimport { Link as RouterLink } from 'react-router-dom'\nimport MUILink from '@mui/material/Link'\n\nconst Link = React.forwardRef(({...props}, ref) => {\n  props.component = 'a'\n  if (props.to){\n    props.component = RouterLink\n  }\n  if (props.to && props.to.startsWith('http')){\n    props.href = props.to\n    delete props.to\n    props.rel = props.rel || \"noopener noreferrer\"\n    props.target = props.target || \"_blank\"\n    props.component = 'a'\n  }\n  return <MUILink {...props} ref={ref}/>\n})\n\nLink.displayName = 'Link'\n\nexport default Link\n","import { useEffect, useCallback } from 'react'\nimport useSWR, { useSWRConfig } from 'swr'\nimport useAsync from './hooks/useAsync'\n\nexport async function fetchQuery(name, options = {}){\n  const params = new URLSearchParams(options)\n  return await apiFetch('GET', `/api/${name}?${params}`)\n}\n\nexport async function fetchCommand(name, options){\n  return await apiFetch('POST', `/api/${name}`, options)\n}\n\nwindow.cqrs = {\n  query: fetchQuery,\n  command: fetchCommand,\n}\n\nasync function apiFetch(method, path, body, tries = 0){\n  const res = await fetch(path, {\n    method,\n    headers: {\n      'Accepts': 'application/json',\n      'Content-Type': 'application/json',\n    },\n    body: body ? JSON.stringify(body) : undefined,\n  })\n  if (res.status === 502){\n    throw new Error(`API server looks down or you're offline`)\n  }\n  if (res.status === 504 && tries < 5) {\n    await wait(500)\n    return apiFetch(method, path, body, tries + 1)\n  }\n  const { result, error } = await res.json()\n  if (error) throw new Error(error.message)\n  return result || null\n}\n\nconst wait = ms => new Promise(resolve => {\n  setTimeout(() => { resolve() }, ms)\n})\n\nexport function useQuery(name, options = {}, config){\n  const swrKey = name ? [name, options] : null\n  const { data: result, error, mutate } = useSWR(swrKey, {\n    ...config,\n    fetcher: fetchQuery,\n  })\n  const loading = typeof result === 'undefined' && !error\n  const reload = useCallback(() => { mutate() }, [mutate])\n  return { result, loading, error, mutate, reload }\n}\n\nexport function useCommand(name, config){\n  return useAsync(\n    options => fetchCommand(name, options),\n    config\n  )\n}\n\nexport function useCommandOnMount(name, options, config){\n  const command = useCommand(name, config)\n  useEffect(\n    () => { if (command.idle) command.call(options) },\n    [name, options]\n  )\n  return command\n}\n"],"names":["$12c5b9a8a881aaa7$var$Link","$667on$react","forwardRef","props","ref","component","to","$667on$reactrouterdom","Link","startsWith","href","rel","target","$667on$reactjsxruntime","jsx","$parcel$interopDefault","$667on$muimaterialLink","displayName","async","$a881e5cea1817cae$export$a1c549e76b7f385e","name","options","params","URLSearchParams","$a881e5cea1817cae$var$apiFetch","$a881e5cea1817cae$export$df781a4386db1cc8","method","path","body","tries","res","fetch","headers","Accepts","JSON","stringify","undefined","status","Error","$a881e5cea1817cae$var$wait","result","error","json","message","window","cqrs","query","command","ms","Promise","resolve","setTimeout"],"version":3,"file":"DebugPage.js.map","sourceRoot":"../../"}